services:
  mediamtx:
    image: bluenviron/mediamtx:latest-ffmpeg
    container_name: gateway-mediamtx
    restart: unless-stopped
    ports:
      - "8554:8554"       # RTSP
      - "8000:8000/udp"   # RTP UDP
      - "8001:8001/udp"   # RTCP UDP
      - "8889:8889"       # WebRTC HTTP
      - "8189:8189/udp"   # WebRTC ICE UDP
      - "8888:8888"       # HLS
      - "1935:1935"       # RTMP
      - "9997:9997"       # API
    volumes:
      - ./mediamtx/mediamtx.yml:/mediamtx.yml
    environment:
      - MTX_LOGLEVEL=info

  onvif-discovery:
    build:
      context: ./onvif-discovery
    container_name: gateway-onvif
    network_mode: host
    restart: unless-stopped
    environment:
      - ONVIF_USER=${ONVIF_USER}
      - ONVIF_PASSWORD=${ONVIF_PASSWORD}
      - MEDIAMTX_API=${MEDIAMTX_API}
      - DISCOVERY_INTERVAL=${DISCOVERY_INTERVAL:-60}
      - SCAN_RANGE=${SCAN_RANGE}
    depends_on:
      - mediamtx
